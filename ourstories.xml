<?xml version="1.0" encoding="UTF-8" ?>
<Module>
  <ModulePrefs title="Our Stories" 
    title_url="http://groups.google.com/group/Google-Gadgets-API" 
    scrolling="true">
  </ModulePrefs>
  <UserPref name="num_entries" display_name="Number of Entries:" default_value="8"/>
  <Content type="html">
  <![CDATA[
  <style>
  
  img {
    display:block;
    margin:0 auto;
  }
  h {
    font-size: 18px;
  }
  p {
    font-size: 12px;
    font-family: Verdana, sans-serif;
  }
    </style>
  <TABLE style="vertical-align:top;width:900px;border-collapse:collapse;">
  <TR>
  <TD style="vertical-align: top;"><a href="http://nzhgpa-airborn.blogspot.co.nz/?view=magazine"><img src="http://www.nzhgpa.org.nz/ourstories.png"></a></TD>
  <TD id="result0"></TD>
    <TD><TABLE style="width:200px;vertical-align:top;border-collapse:collapse;"><TR><TD id="resultA"></TD></TR><TR><TD id="resultB"></TD></TR></TABLE></TD>
  <TD id="result1"></TD>
  <TD id="result2"></TD><TD id="result3"></TD>
  <TD id="result4"></TD><TD id="result5"></TD>
  </TR>
  </TABLE>
  <script type="text/javascript">
  // Get userprefs
  var prefs = new gadgets.Prefs();
  var entries = prefs.getInt("num_entries");
  function getFeed() {  
    var params = {};  
    params[gadgets.io.RequestParameters.CONTENT_TYPE] = gadgets.io.ContentType.TEXT;  
    //params[gadgets.io.RequestParameters.NUM_ENTRIES] = new Number(entries);  
    //params[gadgets.io.RequestParameters.GET_SUMMARIES] = true; 
    var url = "http://feeds.feedburner.com/nzhgpa-ourstories"; 
    gadgets.io.makeRequest(url, response, params);
  };
 function response(obj) { 
   // obj.data contains the feed data
   var feed = obj.text;
   var field = "";
   var sorted = [];
   var descstrg1 = feed.split("<entry>");
   
   for (var i = 0; i < 8; i++) {
     var descstrg2 = descstrg1[i+1].split('<title type="text">');  
     var descstrg3 = descstrg2[1].split("</title>");
     var descstrg4 = descstrg1[i+1].split("<media:thumbnail");
     var descstrg5 = descstrg4[1].split("url=");
     var descstrg6 = descstrg5[1].split('"');
     var descstrg7 = descstrg6[1].replace("/s72-c/","/s100-c/");
     var descstrg8 = descstrg1[i+1].split("Post Comments");
     var descstrg9 = descstrg8[1].split('href="');
     var descstrg10 = descstrg9[1].split("#comment");
     var descstrg11 = descstrg1[i+1].split('<content type="html">');
     var descstrg12 = descstrg11[1].substr(0,71);
   
     field = "result"+i;
     document.getElementById(field).innerHTML = '<a href="' + descstrg10[0] + '/?view=magazine" target = "_blank"><img title="' + descstrg3[0] + '" src="' + descstrg7 + '"></a>';
     
     if ( i==0 ) {
       field = "resultA";
       document.getElementById(field).innerHTML = '<h>' + descstrg3[0] + '</h>';
       field = "resultB";
       document.getElementById(field).innerHTML = '<p>' + descstrg12 + '</p>';
     };
     
   };
   //for (var i = 0; i < 4; i++) {
     //var descstrg1 = feed.split('media:content url="');
     
     //var descstrg3 = feed.split('media:thumbnail url="');
     //var descstrg4 = descstrg3[i+1].split('"');
     //var descstrg5 = feed.split("<media:title>");
     //var descstrg6 = descstrg5[i+1].split("</media:title>");
     
     //var link = descstrg2[0];
     //var image = descstrg4[0];        
     //var descp = descstrg6[0];
  
     //var link = "http://www.youtube.com/playlist?list=PLpVYLDpbv9r6F9ykRsswRl2gXUEOYl35Y";
     //var image = "http://www.nzhgpa.org.nz/_/rsrc/1365502452864/config/customLogo.gif?revision=9";        
     //var descp = "NZHGPA YouTube Playlist";
      
     //sorted[i] = [Math.random(),i,link,image,descp];
   //};
   //sorted.sort(function(a, b)
   //{
     //return a[0]-b[0].xml
   //});
   //for (var i = 1; i < 5 ; i++) {
     //field = "result"+i;
     //document.getElementById(field).textContent = '<a href="' + sorted[i][2] + '" target = "_blank"><img title="' + sorted[i][4] + '" src="' + sorted[i][3] + '" width="100px"></a>';
     //document.getElementById(field).textContent = descstrg5[0]+i;
     //document.getElementById(field).textContent = descstrg3[0];
     //if (sorted[i][1] == 0)
     //{ 
       //document.getElementById(field).setAttribute("style", "background-color: #a7a9ac;");
     //};
   //};
 };
  gadgets.util.registerOnLoadHandler(getFeed);
  </script>
  ]]>
  </Content>
</Module>
